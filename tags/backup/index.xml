<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Backup on MOHDUR</title>
    <link>https://mohdur.github.io/tags/backup/</link>
    <description>Recent content in Backup on MOHDUR</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sat, 24 Oct 2020 19:57:51 +0200</lastBuildDate><atom:link href="https://mohdur.github.io/tags/backup/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Archiwizacja podkatalogów</title>
      <link>https://mohdur.github.io/post/archiwizacja-podkatalogow/</link>
      <pubDate>Sat, 24 Oct 2020 19:57:51 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/archiwizacja-podkatalogow/</guid>
      <description>
        
          &lt;p&gt;Skrypt przetwarza podkatalogi w bieżącej lokalizacji, tworząc archiwa &lt;code&gt;tar&lt;/code&gt;
a następnie usuwa przetworzony katalog.&lt;/p&gt;
&lt;p&gt;W pętli &lt;code&gt;for&lt;/code&gt; możemy użyć maski zawężając wynik wyszukiwania np.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in *dump*&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;lub użyć polecenia &lt;code&gt;ls&lt;/code&gt; np.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;ls -A&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#!/usr/bin/env bash
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;clear
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -----------------------------------------------
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Znajdujesz się w katalogu &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;!!!UWAGA! Niebezpieczenstwo!!!&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;Czy usunac katalogi po archiwizacji? [N/t]: &amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; usunac
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$usunac&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;N&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;usunac&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;T&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;t&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;usunac&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;    *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;       &lt;span class=&#34;nv&#34;&gt;usunac&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$#&lt;/span&gt; -gt &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;tar&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;                  &lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tar &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;tgz&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tar.gz&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;         &lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tgz &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;tbz&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tbz2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tar.bz2&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tbz &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;25&lt;/span&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;txz&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tar.xz&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;         &lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;txz &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;26&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;27&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;28&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tar
&lt;span class=&#34;ln&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;30&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in *
&lt;span class=&#34;ln&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;33&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -d &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;34&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; Archiwizuje &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;35&lt;/span&gt;        tar -cavf &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;.&lt;span class=&#34;nv&#34;&gt;$ext&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;36&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$?&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;37&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$usunac&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;38&lt;/span&gt;                &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;!!! Usuwam: &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;39&lt;/span&gt;                rm -rf &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;40&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;41&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;42&lt;/span&gt;            &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Wystąpił BŁĄD: &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$?&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;43&lt;/span&gt;            &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;44&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;45&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;46&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>Wykonanie kopii zapasowej usługi Nextcloud</title>
      <link>https://mohdur.github.io/post/wykonanie-kopii-zapasowej-us%C5%82ugi-nextcloud/</link>
      <pubDate>Sat, 24 Oct 2020 17:39:30 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/wykonanie-kopii-zapasowej-us%C5%82ugi-nextcloud/</guid>
      <description>
        
          &lt;p&gt;Skrypt do wykonania kopii zapasowej Nextcloud, w celu zwiększenia
bezpieczeństwa, hasło do bazy danych jest przechowywane w bazie programu
&lt;code&gt;pass&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tar --exclude=&amp;#39;/var/www/html/nc/data&amp;#39; -czvf nextcloud-$(date -I).tgz /var/www/html/nc
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;mysqldump --hex-blob -u nextcloud -p$(pass show nc@mysql) nextcloud &amp;gt; nextcloud-$(date -I).sql
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;gzip -9 nextcloud-$(date -I).sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>Backup danych na szyfrowanym nośniku</title>
      <link>https://mohdur.github.io/post/backup-danych-na-szyfrowanym-nosniku.md/</link>
      <pubDate>Sat, 24 Oct 2020 14:33:48 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/backup-danych-na-szyfrowanym-nosniku.md/</guid>
      <description>
        
          &lt;h2 id=&#34;skrypt-wykonujący-kopię-zapasową-na-szyfrowanym-nośniku&#34;&gt;Skrypt wykonujący kopię zapasową na szyfrowanym nośniku&lt;/h2&gt;
&lt;p&gt;Skrypt wykonuje kopię zapasową wybranych katalogów z pominięciem katalogów
zawartych w pliku &lt;code&gt;/home/user/bin/backup2sd.exclude&lt;/code&gt; który jest ustawiony
w zmiennej &lt;code&gt;ExcludeFile&lt;/code&gt;, każdy katalog znajduje się w oddzielnej linii.&lt;/p&gt;
&lt;p&gt;Przykładowy plik &lt;code&gt;/home/user/bin/backup2sd.exclude&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;.Private
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;.PyCharmCE2017.3
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;.cmake
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;.cache
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;.dbus
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt;.ecryptfs
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt;.gimp-2.8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Parametry wywołania skryptu&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-m&lt;/code&gt; - podmontowanie nośnika&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-u&lt;/code&gt; - odmontowanie nośnika&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-b&lt;/code&gt; - wykonanie kopii zapasowej&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-h&lt;/code&gt; - wyświetlenie pomocy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wywołanie skryptu bez parametrów uruchamia wykonanie kopii zapasowej.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;  1&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/env bash
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;  2&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  3&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CryptoName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;CryptoSD
&lt;span class=&#34;ln&#34;&gt;  4&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;Device&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/mmcblk0
&lt;span class=&#34;ln&#34;&gt;  5&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/user
&lt;span class=&#34;ln&#34;&gt;  6&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/user/CryptoSD
&lt;span class=&#34;ln&#34;&gt;  7&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ExcludeFile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/user/skrypty/backup2sd.exclude
&lt;span class=&#34;ln&#34;&gt;  8&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  9&lt;/span&gt;root_chk&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 10&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$EUID&lt;/span&gt; -ne &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 11&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Ten program musisz uruchomić jako root&amp;#34;&lt;/span&gt; 1&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 12&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 13&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 15&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 16&lt;/span&gt;pomoc&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 17&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 18&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 19&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Podmontowanie nośnika.&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 20&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;   # &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; -m&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 21&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 22&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Odmontowanie nośnika.&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 23&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;   # &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; -u&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 24&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 25&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Wykonanie kopii zapasowej.&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 26&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;   # &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; -b&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 27&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 28&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 29&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 30&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 31&lt;/span&gt;mount_sd&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 32&lt;/span&gt;  root_chk
&lt;span class=&#34;ln&#34;&gt; 33&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 34&lt;/span&gt;  /sbin/cryptsetup luksOpen &lt;span class=&#34;nv&#34;&gt;$Device&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 35&lt;/span&gt;  /bin/mount /dev/mapper/&lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt; /home/red/&lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 36&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 37&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 38&lt;/span&gt;umount_sd&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 39&lt;/span&gt;  root_chk
&lt;span class=&#34;ln&#34;&gt; 40&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 41&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;partition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;mount &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;{ print $3 }&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 42&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;crypto&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;ls /dev/mapper/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 43&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 44&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$partition&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 45&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 46&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;Synchronizacja... &amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 47&lt;/span&gt;    /bin/sync &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OK&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 48&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;Odmontowuje partycje... &amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 49&lt;/span&gt;    /bin/umount &lt;span class=&#34;nv&#34;&gt;$partition&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OK&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 50&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 51&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 52&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$crypto&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 53&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 54&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;Zamykam crypto... &amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 55&lt;/span&gt;    /sbin/cryptsetup luksClose &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OK&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 56&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 57&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 58&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 59&lt;/span&gt;backup_sd&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 60&lt;/span&gt;  root_chk
&lt;span class=&#34;ln&#34;&gt; 61&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 62&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;### Montowanie&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 63&lt;/span&gt;  mount_sd
&lt;span class=&#34;ln&#34;&gt; 64&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 65&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;### Backup&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 66&lt;/span&gt;  rsync -a -v --exclude-from&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ExcludeFile&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$SRC&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DST&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 67&lt;/span&gt;  rsync -a /etc &lt;span class=&#34;nv&#34;&gt;$DST&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 68&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 69&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;### Odmontowanie&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 70&lt;/span&gt;  umount_sd
&lt;span class=&#34;ln&#34;&gt; 71&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 72&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 73&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;getopts&lt;/span&gt; :mubh option
&lt;span class=&#34;ln&#34;&gt; 74&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 75&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$option&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt; 76&lt;/span&gt;    m&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;mount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yes&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 77&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 78&lt;/span&gt;    u&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;umount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yes&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 79&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 80&lt;/span&gt;    b&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;backup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yes&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 81&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 82&lt;/span&gt;    h&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; pomoc
&lt;span class=&#34;ln&#34;&gt; 83&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 84&lt;/span&gt;    &lt;span class=&#34;se&#34;&gt;\?&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 85&lt;/span&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;nieznany parametr -&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$OPTARG&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 86&lt;/span&gt;	  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 87&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 88&lt;/span&gt;    :&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 89&lt;/span&gt;      &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Parametr -&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$OPTARG&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; wymaga argumentu.&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 90&lt;/span&gt;      &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 91&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 92&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 93&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 94&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 95&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mount&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 96&lt;/span&gt;  mount_sd
&lt;span class=&#34;ln&#34;&gt; 97&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 98&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 99&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$umount&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;101&lt;/span&gt;  umount_sd
&lt;span class=&#34;ln&#34;&gt;102&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;103&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;104&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;105&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;106&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$backup&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;107&lt;/span&gt;  backup_sd
&lt;span class=&#34;ln&#34;&gt;108&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;109&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;110&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;111&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;112&lt;/span&gt;root_chk
&lt;span class=&#34;ln&#34;&gt;113&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;114&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;115&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;Wykonać kopię zapasową na karcie SD? [T/n]: &amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;116&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; odp
&lt;span class=&#34;ln&#34;&gt;117&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;118&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;119&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$odp&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt;120&lt;/span&gt;  T&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;t&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;121&lt;/span&gt;    backup_sd
&lt;span class=&#34;ln&#34;&gt;122&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;123&lt;/span&gt;  N&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;n&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;124&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;125&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;126&lt;/span&gt;  *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;127&lt;/span&gt;    backup_sd
&lt;span class=&#34;ln&#34;&gt;128&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;129&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;skrypt-formatujący-nośnik-z-obsługą-szyfrowania&#34;&gt;Skrypt formatujący nośnik z obsługą szyfrowania&lt;/h2&gt;
&lt;p&gt;Skrypty używają jako nośnika kopii zapasowej karty SD: &lt;code&gt;/dev/mmcblk30&lt;/code&gt;, jest
on ustawiony w parametrze &lt;code&gt;Device&lt;/code&gt; należy zmienić na właściwy dla swojego
systemu.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CryptoName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;CryptoSD
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;Device&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/dev/mmcblk30
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$EUID&lt;/span&gt; -ne &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;This program must be run as root&amp;#34;&lt;/span&gt; 1&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;cryptsetup luksFormat -s &lt;span class=&#34;m&#34;&gt;512&lt;/span&gt; -h sha512 -i &lt;span class=&#34;m&#34;&gt;333&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Device&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;cryptsetup luksOpen &lt;span class=&#34;nv&#34;&gt;$Device&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;mkfs.ext4 /dev/mapper/&lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;sleep &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;cryptsetup close &lt;span class=&#34;nv&#34;&gt;$CryptoName&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>Lokalna kopia zapasowa z wykorzystaniem restic</title>
      <link>https://mohdur.github.io/post/lokalna-kopia-zapasowa-z-wykorzystaniem-restic/</link>
      <pubDate>Thu, 22 Oct 2020 01:39:58 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/lokalna-kopia-zapasowa-z-wykorzystaniem-restic/</guid>
      <description>
        
          &lt;p&gt;&lt;a href=&#34;https://restic.readthedocs.io/en/latest/&#34;&gt;Restic&lt;/a&gt; jest programem do wykonywania kopii zapasowej na lokalnym dysku lub zdalnym
zasobie np. &lt;a href=&#34;https://www.backblaze.com/b2/cloud-storage.html&#34;&gt;Backblaze B2&lt;/a&gt;. Kopia
zapasowa jest szyfrowana za pomocą klucza z hasłem.&lt;/p&gt;
&lt;h1 id=&#34;przygotowanie-nowego-repozytorium&#34;&gt;Przygotowanie nowego repozytorium&lt;/h1&gt;
&lt;p&gt;Utworzenie repozytorium w katalogu &lt;code&gt;/opt/restic-repo&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;restic init --repo /opt/restic-repo
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;enter password for new repository:
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;enter password again:
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;created restic repository 4c5e0dc100 at /opt/restic-repo
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt;Please note that knowledge of your password is required to access
&lt;span class=&#34;ln&#34;&gt;8&lt;/span&gt;the repository. Losing your password means that your data is
&lt;span class=&#34;ln&#34;&gt;9&lt;/span&gt;irrecoverably lost.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;wykonanie-kopii-zapasowej&#34;&gt;Wykonanie kopii zapasowej&lt;/h1&gt;
&lt;p&gt;Wykonanie kopii zapasowej katalogu &lt;code&gt;~/work&lt;/code&gt; w repozytorium &lt;code&gt;/opt/restic-repo&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;restic -r /opt/restic-repo --verbose backup ~/skrypty
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;open repository
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;enter password for repository:
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;repository 4c5e0dc1 opened successfully, password is correct
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;created new cache in /home/user/.cache/restic
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;lock repository
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;load index files
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;start scan on [/home/user/skrypty]
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;start backup on [/home/user/skrypty]
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;scan finished in 0.377s: 1472 files, 5.572 GiB
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;Files:        1472 new,     0 changed,     0 unmodified
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;Dirs:            2 new,     0 changed,     0 unmodified
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;Data Blobs:   1590 new
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;Tree Blobs:      3 new
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;Added to the repo: 605.453 MiB
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;processed 1472 files, 5.572 GiB in 0:07
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;snapshot ecd12e27 saved
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;lista-kopii-zapasowych&#34;&gt;Lista kopii zapasowych&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;restic -r /opt/restic-repo snapshots
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;enter password for repository:
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;repository 4c5e0dc1 opened successfully, password is correct
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;ID        Time                 Host        Tags        Paths
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;-------------------------------------------------------------------------
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;ecd12e27  2019-05-01 21:28:47  x230.lan                /home/user/skrypty
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;ea90a14b  2019-05-01 21:31:08  x230.lan                /home/user/skrypty
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;d3162c73  2019-05-01 21:33:19  x230.lan                /home/user/bin
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;-------------------------------------------------------------------------
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;3 snapshots
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Lista kopii zapasowych wybranego katalogu&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;restic -r /opt/restic-repo snapshots --path=&amp;#34;/home/user/bin&amp;#34;
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;enter password for repository:
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;repository 4c5e0dc1 opened successfully, password is correct
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;ID        Time                 Host        Tags        Paths
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;---------------------------------------------------------------------
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;d3162c73  2019-05-01 21:33:19  x230.lan                /home/user/bin
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;---------------------------------------------------------------------
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;1 snapshots
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;przywrócenie-plików-z-kopii-zapaswoej&#34;&gt;Przywrócenie plików z kopii zapaswoej&lt;/h1&gt;
&lt;p&gt;Przywrócenie wybranej kopii zapasowej do katalogu &lt;code&gt;/tmp/restore-work&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;restic -r /opt/restic-repo restore 79766175 --target /tmp/restore-work
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Przywrócenie ostatniej kopii zapasowej&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;restic -r /srv/restic-repo restore latest --target /tmp/restore-art --path &amp;#34;/home/art&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>Kopia zapasowa Minio &#43; Restic</title>
      <link>https://mohdur.github.io/post/kopia-zapasowa-minio-&#43;-restic/</link>
      <pubDate>Thu, 22 Oct 2020 01:24:15 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/kopia-zapasowa-minio-&#43;-restic/</guid>
      <description>
        
          &lt;p&gt;Kopie zapasową możemy przechowywać na serwerze MinIO &lt;a href=&#34;https://min.io/,&#34;&gt;https://min.io/,&lt;/a&gt; jest to
serwer służący do przechowywania danych kompatybilny z Amazon S3.&lt;/p&gt;
&lt;p&gt;Serwer można uruchomić z pliku binarnego na lokalnymsystemie lub w dockerze.&lt;/p&gt;
&lt;h1 id=&#34;uruchomienie-serwera&#34;&gt;Uruchomienie serwera&lt;/h1&gt;
&lt;p&gt;Po pobraniu pliku &lt;code&gt;minio&lt;/code&gt; tworzymy katalog gdzie będą przechowywane dane:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;mkdir data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Uruchomieni serwera&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;minio server data
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;Endpoint:  http://192.168.122.1:9000  http://127.0.0.1:9000
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;AccessKey: HWSZL5OL9X37S0DSC3EW
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;SecretKey: d5ByBS50pffe90s9bKqWxxse4jBmEp9Zp5sv0c4c
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;Browser Access:
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;   http://192.168.122.1:9000  http://127.0.0.1:9000
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;Command-line Access: https://docs.min.io/docs/minio-client-quickstart-guide
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;   $ mc config host add myminio http://192.168.122.1:9000 HWSZL5OL9X37S0DSC3EW d5ByBS50pffe90s9bKqWxxse4jBmEp9Zp5sv0c4c
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;Object API (Amazon S3 compatible):
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;   Go:         https://docs.min.io/docs/golang-client-quickstart-guide
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;   Java:       https://docs.min.io/docs/java-client-quickstart-guide
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;   Python:     https://docs.min.io/docs/python-client-quickstart-guide
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;   JavaScript: https://docs.min.io/docs/javascript-client-quickstart-guide
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;   .NET:       https://docs.min.io/docs/dotnet-client-quickstart-guide
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;W tym listingu interesują nas cztery wartości:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AcessKey&lt;/li&gt;
&lt;li&gt;SecretKey&lt;/li&gt;
&lt;li&gt;Command-line Access&lt;/li&gt;
&lt;li&gt;Adres interfejsu webowego&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Korzystając z klienta utworzymy bukiet, na powyszym listingu możemy znaleźć
polecenie &lt;code&gt;$ mc config ...&lt;/code&gt; to polecenie doda serwer pod nazwą &lt;code&gt;myminio&lt;/code&gt;
oczywiście możemy zmienić nazwę.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;./mc config host add myminio http://192.168.122.1:9000 HWSZL5OL9X37S0DSC3EW d5ByBS50pffe90s9bKqWxxse4jBmEp9Zp5sv0c4c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dodanie bukietu&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;./mc mb myminio/nazwabukietu
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;skrypt-do-obsługi-kopii-zapasowych-wykonywanych-przez-restic&#34;&gt;Skrypt do obsługi kopii zapasowych wykonywanych przez Restic&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;  1&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;  2&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  3&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Dostęp do serwera MinIO.&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  4&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;HWSZL5OL9X37S0DSC3EW
&lt;span class=&#34;ln&#34;&gt;  5&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;d5ByBS50pffe90s9bKqWxxse4jBmEp9Zp5sv0c4c
&lt;span class=&#34;ln&#34;&gt;  6&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  7&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Dostęp do serwera MinIO + integracja z programem pass&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  8&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# export AWS_ACCESS_KEY_ID=$(pass show restic/x230/key)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;  9&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# export AWS_SECRET_ACCESS_KEY=$(pass show restic/x230/access)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 10&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 11&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Integracja restic i pass dostęp do haseł.&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 12&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_PASSWORD_COMMAND&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pass show restic/x230&amp;#39;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 13&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 14&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Adres repozytorium.&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 15&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REPO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:http://192.168.122.1:9000/backup-x230&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 16&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESTORE_DIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/restic/restore
&lt;span class=&#34;ln&#34;&gt; 17&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;MOUNT_DIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/restic/mount
&lt;span class=&#34;ln&#34;&gt; 18&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FILES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/restic/files.txt
&lt;span class=&#34;ln&#34;&gt; 19&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 20&lt;/span&gt;init&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 21&lt;/span&gt;    restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; init
&lt;span class=&#34;ln&#34;&gt; 22&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 23&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 24&lt;/span&gt;backup&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 25&lt;/span&gt;    restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; backup --files-from &lt;span class=&#34;nv&#34;&gt;$FILES&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 26&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 27&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 28&lt;/span&gt;snapshots&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 29&lt;/span&gt;    restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; snapshots --cleanup-cache -c
&lt;span class=&#34;ln&#34;&gt; 30&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 31&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 32&lt;/span&gt;restore&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 33&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -z &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 34&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; -p &lt;span class=&#34;s2&#34;&gt;&amp;#34;Brak ID migawki, wyświetlić listę? [T/n]: &amp;#34;&lt;/span&gt; SNAPSHOT
&lt;span class=&#34;ln&#34;&gt; 35&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$SNAPSHOT&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt; 36&lt;/span&gt;            t&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;T&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 37&lt;/span&gt;                snapshots
&lt;span class=&#34;ln&#34;&gt; 38&lt;/span&gt;                &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 39&lt;/span&gt;            n&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;N&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 40&lt;/span&gt;                &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 41&lt;/span&gt;                &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 42&lt;/span&gt;            *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 43&lt;/span&gt;                snapshots
&lt;span class=&#34;ln&#34;&gt; 44&lt;/span&gt;                &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 45&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 46&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 47&lt;/span&gt;        restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; restore &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 48&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;            --target &lt;span class=&#34;nv&#34;&gt;$RESTORE_DIR&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 49&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 50&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 51&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 52&lt;/span&gt;restore-latest&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 53&lt;/span&gt;    restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; restore -v latest &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 54&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;        --target &lt;span class=&#34;nv&#34;&gt;$RESTORE_DIR&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 55&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 56&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 57&lt;/span&gt;mount&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 58&lt;/span&gt;    restic -r &lt;span class=&#34;nv&#34;&gt;$REPO&lt;/span&gt; mount &lt;span class=&#34;nv&#34;&gt;$MOUNT_DIR&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 59&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 60&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 61&lt;/span&gt;pomoc&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 62&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 63&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;------------------------------------------------------&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 64&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| init           - inicjuje repozytorium             |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 65&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| backup         - wykonanie kopii zapasowej         |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 66&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| snapshots      - lista backupów                    |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 67&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| restore        - odtworzenie konkretnego snapshota |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 68&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| restore-latest - odtwarza ostatni snapshot         |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 69&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| mount          - podmontowuje repozytorium         |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 70&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;| help           - wyświetla pomoc                   |&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 71&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;------------------------------------------------------&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 72&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 73&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 74&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 75&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; in
&lt;span class=&#34;ln&#34;&gt; 76&lt;/span&gt;    init&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 77&lt;/span&gt;        init
&lt;span class=&#34;ln&#34;&gt; 78&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 79&lt;/span&gt;    backup&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 80&lt;/span&gt;        backup
&lt;span class=&#34;ln&#34;&gt; 81&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 82&lt;/span&gt;    snapshots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 83&lt;/span&gt;        snapshots
&lt;span class=&#34;ln&#34;&gt; 84&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 85&lt;/span&gt;    restore&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 86&lt;/span&gt;        restore &lt;span class=&#34;nv&#34;&gt;$2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 87&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 88&lt;/span&gt;    restore-latest&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 89&lt;/span&gt;        restore-latest
&lt;span class=&#34;ln&#34;&gt; 90&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 91&lt;/span&gt;    mount&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 92&lt;/span&gt;        mount
&lt;span class=&#34;ln&#34;&gt; 93&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 94&lt;/span&gt;    help&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;pomoc&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 95&lt;/span&gt;        pomoc
&lt;span class=&#34;ln&#34;&gt; 96&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 97&lt;/span&gt;    *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 98&lt;/span&gt;        pomoc
&lt;span class=&#34;ln&#34;&gt; 99&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>Archiwizacja plików za pomocą polecenia tar</title>
      <link>https://mohdur.github.io/post/archiwizacja-plik%C3%B3w-za-pomoc%C4%85-polecenia-tar/</link>
      <pubDate>Thu, 22 Oct 2020 00:15:27 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/archiwizacja-plik%C3%B3w-za-pomoc%C4%85-polecenia-tar/</guid>
      <description>
        
          &lt;h1 id=&#34;przydatne-parametry-polecenia-tar&#34;&gt;Przydatne parametry polecenia tar&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;-z - kompresuje gzip
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;-j - kompresuje bzip2
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;-J - kompresuje xz
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;-a - dobiera sposób kompresji po rozszerzeniu pliku
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;-f - plik wynikowy
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt;-x - dekompresuje
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt;-C - zmienia katalog przed rozpoczęciem archiwizacji
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;przykłady&#34;&gt;Przykłady&lt;/h1&gt;
&lt;h2 id=&#34;tworzy-archiwum-pandoctgz-katalogu-pandoc&#34;&gt;Tworzy archiwum &lt;code&gt;pandoc.tgz&lt;/code&gt; katalogu &lt;code&gt;pandoc&lt;/code&gt;&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tar -caf pandoc.tgz pandoc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;przechodzi-do-katalogu-pandoc-i-tworzy-archiwum-używając-kompresji-xz&#34;&gt;Przechodzi do katalogu &lt;code&gt;pandoc&lt;/code&gt; i tworzy archiwum używając kompresji xz&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tar -C pandoc -caf pandoc.txz .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;sprawdzenie-wielkości-archiwum-przed-i-po-kompresji&#34;&gt;Sprawdzenie wielkości archiwum przed i po kompresji&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;gzip -l site-hugo.tar.gz ; read
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;         compressed        uncompressed  ratio uncompressed_name
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;           19859070            25384960  21.8% site-hugo.tar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
    <item>
      <title>rsync receptury</title>
      <link>https://mohdur.github.io/post/rsync-receptury/</link>
      <pubDate>Wed, 21 Oct 2020 21:51:21 +0200</pubDate>
      
      <guid>https://mohdur.github.io/post/rsync-receptury/</guid>
      <description>
        
          &lt;h1 id=&#34;synchronizacja-przez-ssh&#34;&gt;Synchronizacja przez SSH&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;-e ssh          | połączenie przez SSH np. -e &amp;#34;ssh -l ssh-user -p 22&amp;#34;
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;-a              | zastępuje kilka parametrów -r -l -p -t -g -o -D
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;-v              | wyświetla bieżącą operację
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;-z              | włącza kompresję
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;--delete-before | kasuje pliki w docelowej lokalizacji jeśli te nie istnieją w źródłowej lokalizacji
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;-n              | --dry-run - testowa synchronizacja
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;-r              | synchronizuje podkatalogi
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;-l              | kopiuje linki symboliczne jako linki symboliczne
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;-p              | zachowuje uprawnienia
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;-t              | zachowuje uprawnienia dla grupy
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;-o              | zachowuje uprawnienia dla użytkownika
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;-D              | zachowuje pliki urządzeń (tylko root)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;cd ~/Nextcloud
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;rsync -avz --delete-before -e ssh Instrukcje/ użytkownik@hostname:/opt/backup-rsync/Instrukcje
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;cd ~/Książki
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;rsync -avz --delete-before -e ssh . użytkownik@hostname:/opt/backup-rsync/Books
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Oprócz oczywistej różnicy pomiędzy tymi dwoma poleceniami, jest jeszcze taka
mniej oczywista, mianowicie znak &lt;code&gt;/&lt;/code&gt; na końcu źródłowego katalogu:
&lt;code&gt;Instrukcje/&lt;/code&gt;, można uznać, że taki zapis oznacza użycie polecenia &lt;code&gt;cd Instrukcje&lt;/code&gt; a następnie przejść do synchronizacji.&lt;/p&gt;
&lt;h1 id=&#34;synchronizacja-na-zewnętrznym-udziale-samba-plików-utworzonych-po-wybranej-dacie&#34;&gt;Synchronizacja na zewnętrznym udziale SAMBA plików utworzonych po wybranej dacie&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Skrypt synchronizuje dane na zewnętrznym udziale sieciowym podłączanym na żądanie.&lt;/li&gt;
&lt;li&gt;Jest użyte polecenie &lt;code&gt;find&lt;/code&gt; w celu odnalezienia plików utworzonych po wybranej dacie.&lt;/li&gt;
&lt;li&gt;Dodatkowo skrypt jest zabezpieczony przed kilkukrotnym uruchomieniem, za pomocą pliku PID.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Źródło skryptu:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SKRYPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;basename &lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PIDFILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/run/user/&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;id -u&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/&lt;span class=&#34;nv&#34;&gt;$SKRYPT&lt;/span&gt;.pid
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#PID=&amp;#34;$(&amp;lt;&amp;#34;$PIDFILE&amp;#34;)&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -f &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;9999999&lt;/span&gt; &amp;gt; &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PID_OLD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;pgrep -F &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$?&lt;/span&gt; -eq &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; Poprzedni proces skryptu &lt;span class=&#34;se&#34;&gt;\&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SKRYPT&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&amp;#34;&lt;/span&gt; nadal działa.
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$$&lt;/span&gt; &amp;gt; &lt;span class=&#34;nv&#34;&gt;$PIDFILE&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;umount /mnt/wd-nowy
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;mount.cifs //10.1.1.223/udzial /mnt/wd-nowy -o &lt;span class=&#34;nv&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;uzytkownik,passwd&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tajne-haslo
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;mount &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep /mnt/wd-nowy &amp;gt; /dev/null
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$?&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; Dysk sieciowy nie jest podłączony!
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;25&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;26&lt;/span&gt;find /home/user/ -newermt &lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-11-10 00:00:00&amp;#34;&lt;/span&gt; -type f -print0 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; rsync -a -0 -stats --files-from&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;- / /mnt/wd-nowy
&lt;span class=&#34;ln&#34;&gt;27&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;28&lt;/span&gt;sleep &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;29&lt;/span&gt;umount /mnt/wd-nowy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;rsync-z-pominięciem-wybranych-plików-lub-katalogów&#34;&gt;rsync z pominięciem wybranych plików lub katalogów&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;do wykluczeń jest używany parametr &lt;code&gt;--exclude&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;DATA=$(date +%F-%T)
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;rsync -avz -e &amp;#39;ssh -p 12345&amp;#39; /home/samba/ root@192.168.0.222:/home/samba \
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;    --exclude=samba.tar --exclude=backup \
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;    --log-file=rsync-samba-$DATA.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
        
      </description>
    </item>
    
  </channel>
</rss>
